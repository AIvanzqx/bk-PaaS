APP_LIST=function(){return{_callback_fun:function(){var t=$("#table_app thead").attr("total_app");$("#total_app").text(t),void 0!==t?0==parseInt(t)?($("#page").hide(),$("#app_num_div").hide(),$("#app_num").text(t)):($("#page").show(),$("#app_num_div").show(),$("#app_num").text(t)):$("#app_num_div").hide()},search_app:function(){var t=$.trim($("#search_app").val());if(-1!=t.indexOf("&"))return void art.dialog({id:"bktips",width:300,icon:"warning",lock:!0,content:gettext("错误的搜索参数! 参数中不能包含符号[&]")});var e=($("#status").val(),$("#set_hide_outline").val()),a={url:BLUEKING.config.paas_host()+"app/query_list/?keyword="+t+"&hide_outline="+e+"&",items_per_page:8,current_page:1,callback:APP_LIST._callback_fun,table_obj:"#table_app"};$("#pagination_id").pagination(a)},clear_search_input:function(){$("#search_app").val(""),$("#close_span").css("display","none"),$("#j_display_all_app").click()}}}(),APP_CREATE=function(){return{_check_app_code:function(){var t=!1;return $.ajax({type:"GET",url:BLUEKING.config.paas_host()+"app/check_app_code/",data:{app_code:$.trim($("#code").val())},success:function(e){e.result?t=!0:($("#tip_code").html(e.message),t=!1)},dataType:"json",async:!1}),t},_check_app_name:function(){var t=!1;if("modify"==$("#name").attr("operation"))var e=$.trim($("#name").val());else var e="";return $.ajax({type:"GET",url:BLUEKING.config.paas_host()+"app/check_app_name/",data:{name:$.trim($("#name").val()),old_name:e},success:function(e){e.result?t=!0:($("#tip_name").html(e.message),t=!1)},dataType:"json",async:!1}),t},check_app_code:function(t){var e=!0;if(""==$.trim($("#code").val()))$("#tip_code").html(gettext("请填写应用 ID")),e=!1;else{var a=APP_CREATE._check_app_code();e=a,a&&$("#tip_code").html("")}return e||1!=t||$("#code").focus(),e},check_app_name:function(t){var e=!0;if(""==$.trim($("#name").val()))$("#tip_name").html(gettext("请填写应用名称")),e=!1;else{var a=APP_CREATE._check_app_name();e=a,a&&$("#tip_name").html("")}return e||1!=t||$("#name").focus(),e},check_introduction:function(t){var e=!0;return""==$.trim($("#introduction").val())?($("#tip_introduction").html(gettext("请填写应用简介")),e=!1):UTILS.chkstrlen($.trim($("#introduction").val()))>30?($("#tip_introduction").html(gettext("长度不能超过30个字符")),e=!1):$("#tip_introduction").html(""),e||1!=t||$("#introduction").focus(),e},check_app_tags:function(){var t=!0;return""==$.trim($("#app_tags").val())&&(t=!1),t},check_external_url:function(t){var e=!0;if(0==$("#external_url").length)return e;var a=$("#tip_name");$("#form_app").length&&(a=$("#tip_external_url"));var s=$.trim($("#external_url").val()),_=new RegExp("^(http[s]{0,1})://","gi");return s.match(_)?a.html(""):(a.html(gettext("请填写正确的系统URL，支持http和https")),e=!1),e||1!=t||$("#external_url").focus(),e},check_vcs_url:function(t){var e=!0,a=$.trim($("#vcs_url").val());if(-1!==a.indexOf(" ")||-1!==a.indexOf("|")||-1!==a.indexOf("&")||-1!==a.indexOf(";"))return $("#tip_vcs_url").html(gettext("请填写正确的仓库地址")),1==t&&$("#vcs_url").focus(),!1;var s=$("input[name='vcs_type']:checked").val();if(s||(s=$("#vcs_type_id").val()),"0"==s)var _=new RegExp(/(?:git|ssh|https?|git@[-\w.]+):(\/\/)?(.*?)(\.git)(\/?|\#[-\d\w._]+?)$/,"gi");else var _=new RegExp("(http[s]{0,1}|svn)://[a-zA-Z0-9]","gi");return a.match(_)?$("#tip_vcs_url").html(""):($("#tip_vcs_url").html(gettext("请填写正确的仓库地址")),e=!1),e||1!=t||$("#vcs_url").focus(),e},check_vcs_username:function(t){var e=!0;return""==$.trim($("#vcs_username").val())?($("#tip_vcs_username").html(gettext("请填写账号")),1==t&&$("#vcs_username").focus(),e=!1):$("#tip_vcs_username").html(""),e},check_vcs_password:function(t){var e=!0;return""==$.trim($("#vcs_password").val())?($("#tip_vcs_password").html(gettext("请填写密码")),1==t&&$("#vcs_password").focus(),e=!1):$("#tip_vcs_password").html(""),e},check_db_host:function(){var t=!0;return $.trim($("#db_host").val())?$("#tip_db_host").html(""):($("#tip_db_host").html(gettext("请填写HOST")),t=!1),t},check_db_port:function(){var t=!0,e=$.trim($("#db_port").val());return UTILS.isInt(e)?$("#tip_db_port").html(""):($("#tip_db_port").html(gettext("请填写端口，必须为数字")),t=!1),t},check_db_username:function(){var t=!0;return $.trim($("#db_username").val())?$("#tip_db_username").html(""):($("#tip_db_username").html(gettext("请填写数据库用户名")),t=!1),t},check_window_width_height:function(){var t=$.trim($("#width").val()),e=$.trim($("#height").val());return parseInt(t)>1e4?($("#tip_desktop").html(gettext("宽度超过10000px，请设置合适的宽度")),!1):parseInt(e)>1e4?($("#tip_desktop").html(gettext("高度超过10000px，请设置合适的宽度")),!1):!UTILS.isInt(t)||parseInt(t)<=0?($("#tip_desktop").html(gettext("请填写宽度，必须为正整数")),!1):($("#tip_desktop").html(""),!UTILS.isInt(e)||parseInt(e)<=0?($("#tip_desktop").html(gettext("请填写高度，必须为正整数")),!1):($("#tip_desktop").html(""),!0))},validate_form:function(){$(".tips").text("");return!!APP_CREATE.check_app_code(1)&&(!!APP_CREATE.check_app_name(1)&&(!!APP_CREATE.check_introduction(1)&&(!!APP_CREATE.check_app_tags(1)&&(!!APP_CREATE.check_vcs_url(1)&&(!!APP_CREATE.check_vcs_username(1)&&(!!APP_CREATE.check_vcs_password(1)&&($("button").attr("disabled","disabled"),art.dialog({id:"bktips",width:300,icon:"face-smile",lock:!0,content:gettext("正在创建应用，请稍后...")}),!0)))))))},validate_tpapp_form:function(){$(".tips").text("");return!!APP_CREATE.check_app_code(1)&&(!!APP_CREATE.check_app_name(1)&&(!!APP_CREATE.check_introduction(1)&&(!!APP_CREATE.check_app_tags(1)&&(!!APP_CREATE.check_external_url(1)&&($("button").attr("disabled","disabled"),art.dialog({id:"bktips",width:300,icon:"face-smile",lock:!0,content:gettext("正在创建应用，请稍后...")}),!0)))))}}}(),APP_INFO=function(){return{save_base_info:function(){var t=!1;if(!(t=APP_CREATE.check_app_name()))return!1;if(!(t=APP_CREATE.check_external_url()))return!1;var e=$("#app_code_id").val(),a=BLUEKING.config.paas_host()+"app/modify/"+e+"/";return $.ajax({type:"POST",url:a,data:{operate:"base",name:$.trim($("#name").val()),app_tags:$.trim($("#app_tags").val()),external_url:$.trim($("#external_url").val())},success:function(e){t=e.result,t?$("#app_tags_dis").html($("#app_tags option[value="+$("#app_tags").val()+"]").text()):$("#tip_name").html(e.msg)},dataType:"json",async:!1}),t},get_vcs_password:function(){var t=$("#app_code_id").val(),e="",a=BLUEKING.config.paas_host()+"app/get_vcs_password/"+t+"/";return $.ajax({type:"GET",url:a,data:{},success:function(t){e=t.msg},dataType:"json",async:!1}),e},save_introduction:function(){var t=!1;if(!(t=APP_CREATE.check_introduction()))return!1;var e=$("#app_code_id").val(),a=BLUEKING.config.paas_host()+"app/modify/"+e+"/";return $.ajax({type:"POST",url:a,data:{operate:"introduction",introduction:$.trim($("#introduction").val())},success:function(e){(t=e.result)||$("#tip_introduction").html(e.msg)},dataType:"json",async:!1}),t},save_vcs:function(){var t=!1;if(!(t=APP_CREATE.check_vcs_url()))return!1;if(!(t=APP_CREATE.check_vcs_username()))return!1;if(!(t=APP_CREATE.check_vcs_password()))return!1;var e=$("#app_code_id").val(),a=BLUEKING.config.paas_host()+"app/modify/"+e+"/";return $.ajax({type:"POST",url:a,data:{operate:"vcs",vcs_type:$("#vcs_type_id").val(),vcs_url:$.trim($("#vcs_url").val()),vcs_username:$.trim($("#vcs_username").val()),vcs_password:$.trim($("#vcs_password").val())},success:function(e){(t=e.result)||$("#tip_vcs").html(e.msg)},dataType:"json",async:!1}),t},save_db_info:function(){var t=!1;if(!(t=APP_CREATE.check_db_host()))return!1;if(!(t=APP_CREATE.check_db_port()))return!1;if(!(t=APP_CREATE.check_db_username()))return!1;var e=$("#app_code_id").val(),a=BLUEKING.config.paas_host()+"app/modify/"+e+"/";return $.ajax({type:"POST",url:a,data:{operate:"db",db_type:$("#db_type_id").val(),db_host:$.trim($("#db_host").val()),db_port:$.trim($("#db_port").val()),db_username:$.trim($("#db_username").val()),db_password:$.trim($("#db_password").val())},success:function(e){(t=e.result)||$("#tip_db").html(e.msg)},dataType:"json",async:!1}),t},get_access_info:function(t){var e=BLUEKING.config.paas_host()+"app/status/"+t+"/";$.get(e,{},function(t){app_test_url=t.app_test_url,app_prod_url=t.app_prod_url,1==t.result||2==t.result?$("#test_access_span").html('<a href="'+app_test_url+'" target="_blank" >'+app_test_url+"</a>"):$("#test_access_span").html('<span data-toggle="tooltip" data-placement="top" title='+gettext('"应用未提测或已下架"')+">"+app_test_url+"</span>"),1==t.result||3==t.result?$("#prod_access_span").html('<a href="'+app_prod_url+'" target="_blank" >'+app_prod_url+"</a>"):$("#prod_access_span").html('<span data-toggle="tooltip" data-placement="top" title='+gettext('"应用未上线或已下架"')+">"+app_prod_url+"</span>")},"json")},get_tpapp_access_info:function(t){var e=BLUEKING.config.paas_host()+"app/status/"+t+"/",a=window.location.protocol+"//"+BLUEKING.BK_HOST()+"/console/?app="+t;$.get(e,{},function(t){1==t.result||3==t.result?$("#prod_access_span").html('<a href="'+a+'" target="_blank" >'+a+"</a>"):$("#prod_access_span").html('<span data-toggle="tooltip" data-placement="top" title='+gettext('"应用未上线或已下架"')+">"+a+"</span>")},"json")},show_deploy_apply_info:function(){if(is_base_info=$("#app_code_id").length,1==is_base_info)var t=$("#app_code_id").val();else var t=$("#code").val();var e=BLUEKING.config.paas_host()+"app/show_apply_process/";$.get(e,{is_base_info:is_base_info,app_code:t},function(t){art.dialog({id:"apply_tips",width:700,title:gettext("激活码申请流程"),lock:!0,content:t})})},save_desktop_info:function(){var t=!1;if(!(t=APP_CREATE.check_window_width_height()))return!1;var e=$("#app_code_id").val(),a=BLUEKING.config.paas_host()+"app/modify/"+e+"/";return $.ajax({type:"POST",url:a,data:{operate:"desktop",width:$.trim($("#width").val()),height:$.trim($("#height").val()),open_mode:$.trim($("#open_mode_choices").val())},success:function(e){(t=e.result)||$("#tip_desktop").html(e.msg)},dataType:"json",async:!1}),t}}}(),$("#set_hide_outline").on("change",APP_LIST.search_app),$("#j_display_all_app").on("click",APP_LIST.search_app),$("#close_span").on("click",APP_LIST.clear_search_input),$("#search_app").keyup(function(t){$.trim($("#search_app").val())?$("#close_span").css("display",""):$("#close_span").css("display","none"),"13"==t.keyCode&&$("#j_display_all_app").click()}),$("input[name='code']").on("blur",APP_CREATE.check_app_code),$("input[name='name']").on("blur",APP_CREATE.check_app_name),$("input[name='introduction']").on("blur",APP_CREATE.check_introduction),$("input[name='vcs_url']").on("blur",APP_CREATE.check_vcs_url),$("input[name='vcs_username']").on("blur",APP_CREATE.check_vcs_username),$("input[name='vcs_password']").on("blur",APP_CREATE.check_vcs_password),$("input[name='db_host']").on("blur",APP_CREATE.check_db_host),$("input[name='db_port']").on("blur",APP_CREATE.check_db_port),$("input[name='db_username']").on("blur",APP_CREATE.check_db_username),$("input[name='external_url']").on("blur",APP_CREATE.check_external_url),$(".can_a").click(function(){$(this).hide(),$(this).next(".operate").attr({data:"0"}),$(this).next(".operate").html(gettext("编辑"));var t=$(this).next(".operate").attr("edit-class");"desktop"==t&&$(".desktop_wh_px").show(),$(".col_main ."+t).each(function(){var t=$(this).text();$(this).show(),$(this).prev(".app-edit").hide(),$(this).parents(".app-info").find(".app-info-tips").text(""),"vcs_password_value"==$(this).attr("id")?($(".password_show").show(),$(".password_show").attr("data","0"),$(".password_show").attr("title",gettext("显示密码")),$(".password_show").html('<i class="bk-icon icon-eye t_b t_s12" style="transform: scale(0.8,0.8);"></i>'),$(this).prev(".app-edit").val("")):$(this).prev(".app-edit").val(t)})}),$(".operate").click(function(){var t=$(this).attr("data"),e=$(this).attr("edit-class");if("0"==t)switch($(this).attr({data:"1"}),$(this).html(gettext("保存")),$(this).prev(".can_a").show(),$(".col_main ."+e).hide(),$("."+e).prev(".app-edit").show(),e){case"base":$("#app_tags_div").show();break;case"vcs":case"db":$("."+e).prev(".app-edit").css("display","inline-block"),$(".password_show").hide();break;case"desktop":$(".desktop_wh_px").hide()}else{var a=!1;switch(e){case"base":a=APP_INFO.save_base_info();break;case"introduction":a=APP_INFO.save_introduction();break;case"vcs":a=APP_INFO.save_vcs();break;case"db":a=APP_INFO.save_db_info();break;case"desktop":a=APP_INFO.save_desktop_info()}a&&($(this).attr({data:"0"}),$(this).html(gettext("编辑")),$(this).prev(".can_a").hide(),$("."+e).prev(".app-edit").hide(),"base"==e&&$("#app_tags_div").hide(),"desktop"==e&&$(".desktop_wh_px").show(),$(".col_main ."+e).each(function(){var t=$.trim($(this).prev(".app-value").val());$(this).show(),"vcs_password_value"==$(this).attr("id")?($(this).html("******"),$(this).prev(".app-value").val(""),$(".password_show").show(),$(".password_show").attr("data","0"),$(".password_show").attr("title",gettext("显示密码")),$(".password_show").html('<i class="bk-icon icon-eye t_b t_s12" style="transform: scale(0.8,0.8);"></i>')):"app_tags_dis"==$(this).attr("id")?$(this).text($.trim($("#app_tags option:selected").text())):"open_mode_dis"==$(this).attr("id")?$(this).text($.trim($("#open_mode_choices option:selected").text())):$(this).text($.trim(t))}))}}),$("input[name='vcs_type']").click(function(){"0"==$(this).val()?($("#vcs_url_help").html(gettext("支持以下协议：http(s)://, git://")),$("#vcs_type_help").html(gettext("通过Git方式获取应用代码")),$("#cur_protocol").val(""),$("#vcs_text").text("Git")):($("#vcs_url_help").html(gettext("支持以下协议：http(s)://, svn://<br>请确保 <code>requirements.txt</code> 文件在该目录下")),$("#vcs_type_help").html(gettext("通过SVN方式获取应用代码")),$("#cur_protocol").val("svn://"),$("#vcs_text").text("SVN"))}),$(".password_show").click(function(){if("0"==$(this).attr("data")){$(this).attr("data","1");var t=APP_INFO.get_vcs_password();$("#vcs_password_value").html(t),$(this).attr("title",gettext("隐藏密码")),$(this).html('<i class="bk-icon icon-eye-slash t_b t_s12" style="transform: scale(0.8,0.8);"></i>')}else $("#vcs_password_value").html("******"),$(this).attr("data","0"),$(this).attr("title",gettext("显示密码")),$(this).html('<i class="bk-icon icon-eye t_b t_s12" style="transform: scale(0.8,0.8);"></i>')});