function switch_control(e,t){var c=e?gettext("开启"):gettext("停用"),r="<div class='mb10'>"+gettext("您确定")+"\"<font color='red'>"+c+'</font>"'+gettext("监控告警服务吗")+"?</div>";r+=e?c+gettext("后您可以自定义告警配置。"):c+gettext("后您将无法接收告警。");var o=site_url+"monitor/save_configure/"+t+"/";art.dialog({width:350,icon:"question",lock:!0,content:r,ok:function(){$.post(o,{conf_type:"is_open",is_open:e},function(e){e.result?window.location.reload():art.dialog({title:gettext("温馨提示"),width:340,icon:"error",lock:!0,content:e.msg,ok:function(){},okVal:gettext("关闭")})},"json")},cancel:function(){},okVal:gettext("确定"),cancelVal:gettext("取消")})}function isPositiveInteger(e){return/^\+?([1-9]\d*)$/.test(e)}function isValidEmail(e){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)}function show_msg(e,t){art.dialog({title:gettext("温馨提示"),width:340,icon:t,lock:!0,content:e,ok:function(){},okVal:gettext("关闭")})}$(function(){$(".config_btn").click(function(){var e,t=$(this).attr("id"),c=$(this).attr("app_code"),r=["CRITICAL","ERROR","WARNING","INFO","DEBUG"],o=["50x","500","501","502","503","504","504","40x","400","401","402","403","404","error"];if("http_config_btn"==t){var a=[];for(x in o)code=o[x],$("#http_"+code).attr("checked")&&a.push(code);var i="",n=$("#request_time_gt_or_lt").val(),l=$("#request_time_delay_ms").val(),s=$("#request_time_select").attr("checked");if(s&&!isPositiveInteger(l))return $("#delay_time_tips").html(gettext("输入值不合法!必须为正整数!")).show(),void $("#request_time_delay_ms").focus();if(s)var i="request_time";$("#http_status_codes").val();e={conf_type:"http",http_status_codes:a,request_time_select:i,request_time_gt_or_lt:n,request_time_delay_ms:l,http_alarm_cycle:$("#http_alarm_cycle").val()}}else if("django_config_btn"==t){var _=[];for(x in r)$("#django_"+r[x]).attr("checked")&&_.push(r[x]);var d=$("#django_keyword").val(),h=$("input[name=django_operator][checked=checked]").val(),p=$("#django_alarm_cycle").val();e={conf_type:"django",django_log_levels:_,django_keyword:d,django_operator:h,django_alarm_cycle:p}}else if("celery_config_btn"==t){var u=[];for(x in r)$("#celery_"+r[x]).attr("checked")&&u.push(r[x]);var g=$("#celery_keyword").val(),m=$("input[name=celery_operator][checked=checked]").val(),v=$("#celery_alarm_cycle").val();e={conf_type:"celery",celery_log_levels:u,celery_keyword:g,celery_operator:m,celery_alarm_cycle:v}}else if("component_config_btn"==t){var f=[];for(x in r)$("#component_"+r[x]).attr("checked")&&f.push(r[x]);var y=$("#component_alarm_cycle").val();e={conf_type:"component",component_log_levels:f,component_alarm_cycle:y}}else if("receive_config_btn"==t){var k=$("#email_receivers").val();if(!k)return show_msg(gettext("请输入告警接收人邮箱!"),"error"),!1;for(var q=k.split(";"),x=0;x<q.length;x++)if(email=q[x].replace(/^\s*/,"").replace(/\s*$/,"").replace(/[,|;]$/,""),""!=email&&!isValidEmail(email))return show_msg(gettext("请输入正确的邮箱地址, 多个邮箱请用英文的';'隔开! "),"error"),!1;var w=[];$("#receive_http").attr("checked")&&w.push("http"),$("#receive_django").attr("checked")&&w.push("django"),$("#receive_celery").attr("checked")&&w.push("celery"),$("#receive_component").attr("checked")&&w.push("component"),e={conf_type:"receive",email_receivers:k,alarm_list:w}}var b=site_url+"monitor/save_configure/"+c+"/";$.post(b,e,function(e,t){"success"==t?show_msg(gettext("保存成功!"),"succeed"):show_msg(gettext("保存失败!"),"error")})}),$(".config_check").css("background-color","#f5f5f5"),$(".receive_check").css("background-color","rgb(255, 236, 187)"),$("input[type=radio]").click(function(){var e=$(this).attr("name");$("input[name="+e+"]").removeAttr("checked"),$(this).attr("checked","checked")}),$(".config_check").click(function(){var e=$(this).attr("id").split("_").pop();$("#basic_alarm_"+e).slideToggle(300);var t=$("#basic-alarm-icon-"+e);t.hasClass("glyphicon-chevron-down")?(t.removeClass("glyphicon-chevron-down").addClass("glyphicon-chevron-up"),$(this).attr("title","")):t.hasClass("glyphicon-chevron-up")&&(t.removeClass("glyphicon-chevron-up").addClass("glyphicon-chevron-down"),$(this).attr("title",gettext("展开详情")))}),$("#request_time_select").change(function(){$(this).attr("checked")?$(".request_input").prop("disabled",!1):$(".request_input").prop("disabled",!0)}),""==$("#request_select_val").val()?$(".request_input").prop("disabled",!0):($("#request_time_select").attr("checked","checked"),$(".request_input").prop("disabled",!1)),$("#request_time_gt_or_lt option[value='"+$("#gt_or_lt_val").val()+"']").attr("selected",!0),$("#request_time_delay_ms").blur(function(){if("checked"==$("#request_time_select").attr("checked")){if(isNaN($("#request_time_delay_ms").val()))return $("#delay_time_tips").html(gettext("输入值不合法!")).show(),void $("#request_time_delay_ms").focus();$("#delay_time_tips").hide()}})});