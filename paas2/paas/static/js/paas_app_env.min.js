$(function(){$("#user_env_table").on("click",".env_edit_btn",function(){var t=$(this).closest(".env_record");t.addClass("env_edit_status"),t.find("input").removeAttr("disabled"),t.find("select").removeAttr("disabled");var e=t.find(".env_name").val(),n=t.find(".env_val").val(),i=t.find(".env_mode").val(),a=t.find(".env_intro").val();return t.attr("data-old-name",e),t.attr("data-old-val",n),t.attr("data-old-intro",a),t.attr("data-old-mode",i),!1}),$("#user_env_table").on("click",".env_cancel_btn",function(){var t=$(this).closest(".env_record");t.removeClass("env_edit_status"),t.find("input").attr("disabled","disabled"),t.find("select").attr("disabled","disabled");var e=t.attr("data-old-name"),n=t.attr("data-old-val"),i=t.attr("data-old-intro"),a=t.attr("data-old-mode");if(e||n||i||a){t.find(".env_name").val(e),t.find(".env_val").val(n),t.find(".env_intro").val(i),t.find(".env_mode").val(a)}else t.remove();return!1}),$("#user_env_table").on("click",".env_save_btn",function(){var t=($(this),$(this).closest(".env_record")),e=t.find(".env_intro").val(),n=t.find(".env_name").val(),i=t.find(".env_val").val(),a=t.find(".env_mode").val(),d=t.find(".env_id").val();if(!n)return art.dialog({id:"bktips",width:300,icon:"warning",lock:!0,content:gettext("请输入变量名")}).time(1),t.find(".env_name").focus(),!1;if(!i)return art.dialog({id:"bktips",width:300,icon:"warning",lock:!0,content:gettext("请输入变量值")}).time(1),t.find(".env_val").focus(),!1;if(!e)return art.dialog({id:"bktips",width:300,icon:"warning",lock:!0,content:gettext("请输入说明")}).time(1),t.find(".env_intro").focus(),!1;var o={name:n,value:i,intro:e,mode:a};d&&(o.id=d);var l=$("#app_code").val(),r=site_url+"app/env/"+l+"/add/";return $.post(r,o,function(e,n){"success"==n?e.result?(art.dialog({id:"bktips",width:300,icon:"succeed",lock:!0,content:gettext("保存成功")}).time(1),t.find("input").attr("disabled","disabled"),t.find("select").attr("disabled","disabled"),t.removeClass("env_edit_status"),t.find(".env_id").val(e.id)):art.dialog({id:"bktips",width:300,icon:"error",lock:!0,content:e.msg}).time(1):art.dialog({id:"bktips",width:300,icon:"error",lock:!0,content:gettext("保存失败!")}).time(1)},"json"),!1}),$(".env_add_btn").on("click",function(){var t=$("#mode_choices_html").html(),e=['<tr class="env_record env_edit_status">','<input  type="hidden" class="env_id" disabled value="" />',"    <td>",'       <div class="env_key_box">','           <input class="form-control env_name" value="" placeholder="'+gettext("请输入变量名")+'"/>','           <span class="env_prefix">BKAPP_</span>',"        </div>","    </td>","    <td>",'        <input class="form-control env_val" value="" placeholder="'+gettext("请输入变量值")+'">',"    </td>","    <td>",t,"    </td>","    <td>",'       <input class="form-control env_intro" value="" placeholder="'+gettext("请输入说明")+'">',"    </td>","    <td>",'    <button type="button" class="btn-info btn-xs env_save_btn">'+gettext("保存")+"</button>",'       <button type="button" class="btn-xs env_cancel_btn">'+gettext("取消")+"</button> ",'  <a href="#" title="'+gettext("编辑")+'" class="dev_env_opera env_edit_btn"><span aria-hidden="true" class="glyphicon glyphicon-edit"></span></a>','  <a href="#" title="'+gettext("删除")+'" class="dev_env_opera env_del_btn"><span aria-hidden="true" class="glyphicon glyphicon-remove-circle"></span></a>',"    </td>","</tr>"].join("");return $("#no_record_row").hide(),$("#user_env_table").append($(e)),!1}),$("#user_env_table").on("click",".env_del_btn",function(){var t=$(this).closest(".env_record"),e=t.find(".env_id").val();if(e){var n=$("#app_code").val(),i=site_url+"app/env/"+n+"/delete/";art.dialog({title:gettext("删除确认"),width:340,icon:"question",lock:!0,content:"<div class='t_s14'>"+gettext("您确定删除该环境变量吗?")+"</div>",ok:function(){art.dialog({id:"bktips",width:300,icon:"warning",lock:!0,content:gettext("正在进行删除操作，请稍后...")}),$.post(i,{id:e},function(e){art.dialog({id:"bktips"}).close(),e.result?(art.dialog({id:"bktips",width:300,icon:"succeed",lock:!0,content:e.msg}).time(1),t.remove()):art.dialog({id:"bktips",width:300,icon:"error",lock:!0,content:e.msg}).time(1)},"json")},cancel:function(){},okVal:gettext("确定"),cancelVal:gettext("取消")})}})});